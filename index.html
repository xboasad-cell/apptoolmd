<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deploy Manager with Accumulative Logic</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            padding: 10px;
            line-height: 1.3;
            font-size: 13px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 3px;
            font-size: 1.4rem;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 0.8rem;
        }
        
        /* Card Styling */
        .card {
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
            padding: 12px;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 0.95rem;
            color: #2c3e50;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .card-title i {
            color: #3498db;
        }
        
        /* Inline Blocks */
        .inline-block {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }
        
        .inline-label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.75rem;
            white-space: nowrap;
        }
        
        .inline-input {
            padding: 5px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.8rem;
            width: 90px;
            text-align: center;
        }
        
        .inline-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .inline-select {
            width: 120px;
        }
        
        /* Buttons */
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 5px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            white-space: nowrap;
            height: 28px;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-add {
            background-color: #2ecc71;
        }
        
        .btn-add:hover {
            background-color: #27ae60;
        }
        
        .btn-remove {
            background-color: #e74c3c;
            padding: 3px 6px;
            font-size: 0.7rem;
        }
        
        .btn-remove:hover {
            background-color: #c0392b;
        }
        
        .btn-calc {
            background-color: #9b59b6;
        }
        
        .btn-calc:hover {
            background-color: #8e44ad;
        }
        
        .btn-primary {
            background-color: #3498db;
        }
        
        /* Seeds Display */
        .seeds-display {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }
        
        .seed-item {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background-color: #e3f2fd;
            border-radius: 4px;
            border: 1px solid #bbdefb;
            font-size: 0.75rem;
        }
        
        .seed-name {
            font-weight: 600;
            color: #1565c0;
        }
        
        .seed-qty {
            color: #0d47a1;
            background-color: #bbdefb;
            padding: 1px 5px;
            border-radius: 8px;
            font-size: 0.7rem;
            min-width: 60px;
            text-align: center;
        }
        
        .seed-qty-input {
            width: 70px;
            padding: 2px 4px;
            border: 1px solid #bbdefb;
            border-radius: 4px;
            font-size: 0.7rem;
            text-align: center;
            color: #0d47a1;
            background-color: white;
            font-weight: 600;
        }
        
        .seed-qty-input:focus {
            outline: none;
            border-color: #1565c0;
            box-shadow: 0 0 0 2px rgba(21, 101, 192, 0.2);
        }
        
        /* Seed Usage */
        .seed-usage {
            margin-top: 10px;
            padding: 8px;
            background-color: #fff8e1;
            border-radius: 4px;
            border: 1px solid #ffe082;
        }
        
        .usage-title {
            font-weight: 600;
            color: #f57c00;
            margin-bottom: 6px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .usage-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .usage-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 5px 8px;
            background-color: white;
            border-radius: 4px;
            border: 1px solid #ffcc80;
            font-size: 0.75rem;
        }
        
        .usage-seed {
            font-weight: 600;
            color: #e65100;
        }
        
        .usage-value {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .usage-value-input {
            width: 80px;
            padding: 3px 6px;
            border: 1px solid #ffcc80;
            border-radius: 4px;
            font-size: 0.75rem;
            text-align: center;
            font-weight: 600;
        }
        
        .usage-value-input:focus {
            outline: none;
            border-color: #f57c00;
            box-shadow: 0 0 0 2px rgba(245, 124, 0, 0.2);
        }
        
        /* Table Styling */
        .deploy-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .deploy-table th {
            background-color: #f8f9fa;
            color: #2c3e50;
            font-weight: 600;
            font-size: 0.75rem;
            text-align: left;
            padding: 8px;
            border-bottom: 2px solid #dee2e6;
            white-space: nowrap;
        }
        
        .deploy-table td {
            padding: 8px;
            border-bottom: 1px solid #eee;
            font-size: 0.8rem;
            vertical-align: middle;
        }
        
        .deploy-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .deploy-table input,
        .deploy-table select {
            width: 100%;
            padding: 4px 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.8rem;
            text-align: center;
        }
        
        .deploy-table input:focus,
        .deploy-table select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .table-seed {
            font-weight: 600;
            color: #1565c0;
        }
        
        .table-range {
            color: #2c3e50;
            font-weight: 600;
        }
        
        .table-start {
            color: #27ae60;
            font-weight: 600;
        }
        
        .table-end {
            color: #e74c3c;
            font-weight: 600;
        }
        
        .table-actions {
            text-align: center;
            width: 40px;
        }
        
        /* Warning row */
        .warning-row {
            background-color: #ffebee !important;
        }
        
        .warning-cell {
            color: #c62828;
            font-size: 0.7rem;
            padding: 4px;
            background-color: #ffebee;
            border-radius: 3px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid #eee;
        }
        
        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid #eee;
            font-size: 0.75rem;
            color: #7f8c8d;
        }
        
        .stats-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .stat-value {
            font-weight: 600;
            color: #2c3e50;
        }
        
        /* No Data */
        .no-data {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 10px;
            border: 1px dashed #ddd;
            border-radius: 4px;
            background-color: #fafafa;
            font-size: 0.8rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .inline-block {
                flex-direction: column;
                align-items: stretch;
            }
            
            .inline-input, .inline-select {
                width: 100%;
            }
            
            .deploy-table {
                display: block;
                overflow-x: auto;
            }
            
            .deploy-table th,
            .deploy-table td {
                white-space: nowrap;
            }
            
            .stats-bar {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Deploy Manager</h1>
           
        </header>
        
        <!-- Seed Management -->
        <div class="card">
            <h2 class="card-title"><i class="fas fa-seedling"></i> Seeds</h2>
            
            <!-- Add Seed -->
            <div class="inline-block">
                <span class="inline-label">Add Seed:</span>
                <input type="text" id="seedName" class="inline-input" placeholder="Name" style="width: 100px;">
                <input type="number" id="seedQuantity" class="inline-input" placeholder="Qty" min="0" value="540540" style="width: 80px;">
                <button id="addSeedBtn" class="btn btn-add">
                    <i class="fas fa-plus"></i> Add
                </button>
            </div>
            
            <!-- Seeds Display -->
            <div class="seeds-display" id="seedsList">
                <div class="no-data">No seeds</div>
            </div>
            
            <!-- Seed Usage -->
            <div class="seed-usage" id="seedUsageDisplay">
                <div class="usage-title">
                    <i class="fas fa-chart-pie"></i> Current Seeds Value (Updated after each calculation)
                </div>
                <div class="usage-items" id="usageItems">
                    <div class="no-data">No usage data</div>
                </div>
            </div>
        </div>
        
        <!-- Add Deploy Section -->
        <div class="card">
            <h2 class="card-title"><i class="fas fa-plus-circle"></i> Add Deploy</h2>
            
            <!-- Quick Add Form -->
            <div class="inline-block">
                <span class="inline-label">Name:</span>
                <input type="text" class="inline-input" id="quickDeployName" placeholder="D4" style="width: 70px;">
                
                <span class="inline-label">Seed:</span>
                <select class="inline-input inline-select" id="quickDeploySeed">
                    <option value="">Select</option>
                </select>
                
                <span class="inline-label">IPs:</span>
                <input type="number" class="inline-input" id="quickDeployIps" min="1" value="10" style="width: 60px;">
                
                <span class="inline-label">Vol/IP:</span>
                <input type="number" class="inline-input" id="quickDeployVolume" min="1" value="5000" style="width: 80px;">
                
                <button id="addDeployBtn" class="btn btn-add">
                    <i class="fas fa-plus"></i> Add Deploy
                </button>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button id="calculateAllBtn" class="btn btn-calc" style="flex: 1;">
                    <i class="fas fa-calculator"></i> Calculate & Update Current Seeds
                </button>
                <button id="clearAllBtn" class="btn btn-remove">
                    <i class="fas fa-trash"></i> Clear All
                </button>
            </div>
        </div>
        
        <!-- Deploys List -->
        <div class="card">
            <h2 class="card-title"><i class="fas fa-rocket"></i> Deploys</h2>
            
            <div id="deploysContainer">
                <div class="no-data">No deploys yet. Click "Add Deploy" to create one.</div>
            </div>
        </div>
        
        <!-- Stats -->
        <div class="stats-bar">
            <div class="stats-item">
                <span>Seeds:</span>
                <span class="stat-value" id="totalSeeds">0</span>
            </div>
            <div class="stats-item">
                <span>Deploys:</span>
                <span class="stat-value" id="deployCount">0</span>
            </div>
            <div class="stats-item">
                <i class="fas fa-database"></i>
                <span id="lastSaved">Auto-saved</span>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let seeds = [];
        let deploys = [];
        let nextDeployId = 1;
        let seedCurrentUsage = {}; // Tracks last end range value for each seed
        
        // DOM Elements
        const seedNameInput = document.getElementById('seedName');
        const seedQuantityInput = document.getElementById('seedQuantity');
        const addSeedBtn = document.getElementById('addSeedBtn');
        const seedsList = document.getElementById('seedsList');
        const totalSeeds = document.getElementById('totalSeeds');
        const usageItems = document.getElementById('usageItems');
        const seedUsageDisplay = document.getElementById('seedUsageDisplay');
        
        // Quick add form elements
        const quickDeployName = document.getElementById('quickDeployName');
        const quickDeploySeed = document.getElementById('quickDeploySeed');
        const quickDeployIps = document.getElementById('quickDeployIps');
        const quickDeployVolume = document.getElementById('quickDeployVolume');
        const addDeployBtn = document.getElementById('addDeployBtn');
        
        // Action buttons
        const calculateAllBtn = document.getElementById('calculateAllBtn');
        const clearAllBtn = document.getElementById('clearAllBtn');
        
        // Results elements
        const deploysContainer = document.getElementById('deploysContainer');
        const deployCount = document.getElementById('deployCount');
        const lastSaved = document.getElementById('lastSaved');
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load from localStorage
            loadData();
            
            // Add example seeds if none
            if (seeds.length === 0) {
                const teamEId = addSeed('Team E', 540540);
                const teamBId = addSeed('Team B', 537710);
                
                // Set initial current seeds based on your image
                seedCurrentUsage[teamEId] = 50000;  // From image: Team E current 50000
                seedCurrentUsage[teamBId] = 60000;  // From image: Team B current 60000 (initial)
                
                // Add example deploys from image
                addDeployFromImage('D1', teamBId, 4, 6000);
                addDeployFromImage('D2', teamBId, 6, 6000);
                addDeployFromImage('D3', teamEId, 10, 5000);
                
                // Calculate to get correct current seeds
                calculateAllRangesSilent();
            }
            
            // Initialize seed usage
            initializeSeedUsage();
            
            // Update UI
            updateUI();
            
            // Setup event listeners
            setupEventListeners();
        });
        
        // Load data
        function loadData() {
            try {
                const savedSeeds = localStorage.getItem('deployManager_seeds');
                const savedDeploys = localStorage.getItem('deployManager_deploys');
                const savedUsage = localStorage.getItem('deployManager_usage');
                
                if (savedSeeds) seeds = JSON.parse(savedSeeds);
                if (savedDeploys) deploys = JSON.parse(savedDeploys);
                if (savedUsage) seedCurrentUsage = JSON.parse(savedUsage);
                if (deploys.length > 0) nextDeployId = Math.max(...deploys.map(d => d.id)) + 1;
            } catch (e) {
                console.log('Starting fresh');
            }
        }
        
        // Save data
        function saveData() {
            try {
                localStorage.setItem('deployManager_seeds', JSON.stringify(seeds));
                localStorage.setItem('deployManager_deploys', JSON.stringify(deploys));
                localStorage.setItem('deployManager_usage', JSON.stringify(seedCurrentUsage));
                
                // Update timestamp
                const now = new Date();
                lastSaved.textContent = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            } catch (e) {
                console.error('Save failed:', e);
            }
        }
        
        // Initialize seed usage
        function initializeSeedUsage() {
            seeds.forEach(seed => {
                if (!seedCurrentUsage[seed.id]) seedCurrentUsage[seed.id] = 0;
            });
        }
        
        // Update UI
        function updateUI() {
            updateSeedsList();
            updateSeedSelects();
            updateUsageDisplay();
            updateDeploysTable();
            updateStats();
        }
        
        // Update seeds list with editable quantity
        function updateSeedsList() {
            if (seeds.length === 0) {
                seedsList.innerHTML = '<div class="no-data">No seeds</div>';
                return;
            }
            
            seedsList.innerHTML = seeds.map(seed => `
                <div class="seed-item" data-id="${seed.id}">
                    <span class="seed-name">${seed.name}</span>
                    <input type="number" class="seed-qty-input" value="${seed.quantity}" data-seed-id="${seed.id}" min="0">
                    <span style="font-size: 0.7rem; color: #27ae60;">(current: ${seedCurrentUsage[seed.id] || 0})</span>
                    <button class="btn btn-remove remove-seed-btn" title="Remove">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
            
            // Add remove listeners
            document.querySelectorAll('.remove-seed-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const seedId = parseInt(this.closest('.seed-item').dataset.id);
                    removeSeed(seedId);
                });
            });
            
            // Add event listeners to seed quantity inputs
            document.querySelectorAll('.seed-qty-input').forEach(input => {
                input.addEventListener('change', function() {
                    const seedId = parseInt(this.dataset.seedId);
                    const newValue = parseInt(this.value) || 0;
                    updateSeedQuantity(seedId, newValue);
                });
                
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const seedId = parseInt(this.dataset.seedId);
                        const newValue = parseInt(this.value) || 0;
                        updateSeedQuantity(seedId, newValue);
                        this.blur(); // Remove focus
                    }
                });
            });
        }
        
        // Update seed quantity
        function updateSeedQuantity(seedId, newQuantity) {
            const seed = seeds.find(s => s.id === seedId);
            if (!seed) return;
            
            // Ensure quantity is valid
            if (newQuantity < 0) newQuantity = 0;
            
            // Update the seed quantity
            seed.quantity = newQuantity;
            
            // If current usage exceeds new quantity, adjust it
            if (seedCurrentUsage[seedId] > newQuantity) {
                seedCurrentUsage[seedId] = newQuantity;
            }
            
            // Update UI and save
            updateUsageDisplay();
            updateDeploysTable();
            saveData();
        }
        
        // Update seed selects
        function updateSeedSelects() {
            if (seeds.length === 0) {
                quickDeploySeed.innerHTML = '<option value="">No seeds</option>';
                return;
            }
            
            let options = '<option value="">Select</option>';
            seeds.forEach(seed => {
                options += `<option value="${seed.id}">${seed.name}</option>`;
            });
            
            quickDeploySeed.innerHTML = options;
        }
        
        // Update usage display with editable current seeds
        function updateUsageDisplay() {
            if (seeds.length === 0) {
                usageItems.innerHTML = '<div class="no-data">No usage data</div>';
                seedUsageDisplay.style.display = 'none';
                return;
            }
            
            let usageHTML = '';
            seeds.forEach(seed => {
                const usage = seedCurrentUsage[seed.id] || 0;
                const percent = seed.quantity > 0 ? ((usage / seed.quantity) * 100).toFixed(2) : '0.00';
                
                usageHTML += `
                    <div class="usage-item" data-seed-id="${seed.id}">
                        <span class="usage-seed">${seed.name}:</span>
                        <span class="usage-value">
                            Current: 
                            <input type="number" class="usage-value-input" value="${usage}" data-seed-id="${seed.id}" min="0" max="${seed.quantity}">
                             | Total: ${seed.quantity} (${percent}%)
                        </span>
                    </div>
                `;
            });
            
            usageItems.innerHTML = usageHTML;
            seedUsageDisplay.style.display = 'block';
            
            // Add event listeners to usage value inputs
            document.querySelectorAll('.usage-value-input').forEach(input => {
                input.addEventListener('change', function() {
                    const seedId = parseInt(this.dataset.seedId);
                    const newValue = parseInt(this.value) || 0;
                    updateCurrentSeeds(seedId, newValue);
                });
                
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const seedId = parseInt(this.dataset.seedId);
                        const newValue = parseInt(this.value) || 0;
                        updateCurrentSeeds(seedId, newValue);
                        this.blur(); // Remove focus
                    }
                });
            });
        }
        
        // Update current seeds value manually
        function updateCurrentSeeds(seedId, newValue) {
            const seed = seeds.find(s => s.id === seedId);
            if (!seed) return;
            
            // Ensure value is within bounds
            if (newValue < 0) newValue = 0;
            if (newValue > seed.quantity) newValue = seed.quantity;
            
            // Update the current seeds value
            seedCurrentUsage[seedId] = newValue;
            
            // Update UI and save
            updateSeedsList();
            updateDeploysTable();
            saveData();
        }
        
        // Update deploys table - TABLE FORMAT
        function updateDeploysTable() {
            if (deploys.length === 0) {
                deploysContainer.innerHTML = '<div class="no-data">No deploys yet. Click "Add Deploy" to create one.</div>';
                return;
            }
            
            // First, calculate cumulative values for each seed separately
            const seedCumulative = {};
            
            // Initialize cumulative for each seed with current usage
            seeds.forEach(seed => {
                seedCumulative[seed.id] = seedCurrentUsage[seed.id] || 0;
            });
            
            // Create table HTML
            let tableHTML = `
                <table class="deploy-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Seed</th>
                            <th>IPs</th>
                            <th>Vol/IP</th>
                            <th>Range</th>
                            <th>Start</th>
                            <th>End</th>
                            <th class="table-actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            // For each deploy, calculate based on its seed's cumulative value
            deploys.forEach(deploy => {
                const seed = seeds.find(s => s.id === deploy.seedId);
                const seedName = seed ? seed.name : 'No seed';
                const seedQuantity = seed ? seed.quantity : 0;
                
                // Calculate range for this deploy
                const deployRange = deploy.ipCount * deploy.volumePerIP;
                
                // Get current cumulative value for this seed
                const currentCumulative = seedCumulative[deploy.seedId] || 0;
                
                // Calculate start and end for this deploy
                const startRange = currentCumulative;
                const endRange = startRange + deployRange;
                
                // Check if exceeds capacity
                const exceedsCapacity = endRange > seedQuantity;
                const warningClass = exceedsCapacity ? 'warning-row' : '';
                
                // Update cumulative for next deploy with same seed
                if (endRange > seedQuantity) {
                    // Reset to 0, then add deploy range
                    seedCumulative[deploy.seedId] = deployRange;
                } else {
                    seedCumulative[deploy.seedId] = endRange;
                }
                
                // Display end range (if exceeds, show 0 + deployRange)
                const displayEndRange = exceedsCapacity ? deployRange : endRange;
                
                tableHTML += `
                    <tr class="${warningClass}" data-id="${deploy.id}">
                        <td>
                            <input type="text" class="table-name-input" value="${deploy.name}" data-deploy-id="${deploy.id}" style="width: 100px;">
                        </td>
                        <td>
                            <select class="table-seed-select" data-deploy-id="${deploy.id}" style="width: 100px;">
                                ${getSeedOptions(deploy.seedId)}
                            </select>
                        </td>
                        <td>
                            <input type="number" class="table-ips-input" value="${deploy.ipCount}" data-deploy-id="${deploy.id}" style="width: 50px;" min="1">
                        </td>
                        <td>
                            <input type="number" class="table-volume-input" value="${deploy.volumePerIP}" data-deploy-id="${deploy.id}" style="width: 70px;" min="1">
                        </td>
                        <td>
                            <span class="table-range">${deployRange}</span>
                        </td>
                        <td>
                            <span class="table-start">${startRange}</span>
                        </td>
                        <td>
                            <span class="table-end">${displayEndRange}</span>
                        </td>
                        <td class="table-actions">
                            <button class="btn btn-remove remove-deploy-btn" title="Remove">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                
                // Add warning row if exceeds capacity
                if (exceedsCapacity) {
                    tableHTML += `
                        <tr class="warning-row">
                            <td colspan="8">
                                <div class="warning-cell">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    Exceeds seed capacity! Will reset to 0
                                </div>
                            </td>
                        </tr>
                    `;
                }
            });
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            deploysContainer.innerHTML = tableHTML;
            
            // Add event listeners to table inputs
            setupTableInputListeners();
            
            // Add remove listeners
            document.querySelectorAll('.remove-deploy-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const deployId = parseInt(this.closest('tr').dataset.id);
                    removeDeploy(deployId);
                });
            });
        }
        
        // Get seed options for select
        function getSeedOptions(selectedId = null) {
            let options = '<option value="">Select</option>';
            
            if (seeds.length === 0) {
                return options;
            }
            
            seeds.forEach(seed => {
                const selected = selectedId === seed.id ? 'selected' : '';
                options += `<option value="${seed.id}" ${selected}>${seed.name}</option>`;
            });
            
            return options;
        }
        
        // Setup event listeners for table inputs
        function setupTableInputListeners() {
            // Name inputs
            document.querySelectorAll('.table-name-input').forEach(input => {
                input.addEventListener('input', function() {
                    const deployId = parseInt(this.dataset.deployId);
                    updateDeployName(deployId, this.value);
                });
            });
            
            // Seed selects
            document.querySelectorAll('.table-seed-select').forEach(select => {
                select.addEventListener('change', function() {
                    const deployId = parseInt(this.dataset.deployId);
                    const seedId = this.value ? parseInt(this.value) : null;
                    updateDeploySeed(deployId, seedId);
                });
            });
            
            // IPs inputs
            document.querySelectorAll('.table-ips-input').forEach(input => {
                input.addEventListener('input', function() {
                    const deployId = parseInt(this.dataset.deployId);
                    const value = parseInt(this.value) || 0;
                    updateDeployIps(deployId, value);
                });
            });
            
            // Volume inputs
            document.querySelectorAll('.table-volume-input').forEach(input => {
                input.addEventListener('input', function() {
                    const deployId = parseInt(this.dataset.deployId);
                    const value = parseInt(this.value) || 0;
                    updateDeployVolume(deployId, value);
                });
            });
        }
        
        // Update deploy name
        function updateDeployName(deployId, name) {
            const deploy = deploys.find(d => d.id === deployId);
            if (deploy) {
                deploy.name = name || `Deploy ${deployId}`;
                updateDeploysTable();
                saveData();
            }
        }
        
        // Update deploy seed
        function updateDeploySeed(deployId, seedId) {
            const deploy = deploys.find(d => d.id === deployId);
            if (deploy) {
                deploy.seedId = seedId;
                updateDeploysTable();
                saveData();
            }
        }
        
        // Update deploy IPs
        function updateDeployIps(deployId, ipCount) {
            const deploy = deploys.find(d => d.id === deployId);
            if (deploy) {
                deploy.ipCount = Math.max(1, ipCount);
                updateDeploysTable();
                saveData();
            }
        }
        
        // Update deploy volume
        function updateDeployVolume(deployId, volume) {
            const deploy = deploys.find(d => d.id === deployId);
            if (deploy) {
                deploy.volumePerIP = Math.max(1, volume);
                updateDeploysTable();
                saveData();
            }
        }
        
        // Update stats
        function updateStats() {
            totalSeeds.textContent = seeds.length;
            deployCount.textContent = deploys.length;
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Add seed
            addSeedBtn.addEventListener('click', addSeedFunc);
            seedNameInput.addEventListener('keypress', (e) => e.key === 'Enter' && addSeedFunc());
            seedQuantityInput.addEventListener('keypress', (e) => e.key === 'Enter' && addSeedFunc());
            
            // Add deploy
            addDeployBtn.addEventListener('click', addDeployFunc);
            quickDeployName.addEventListener('keypress', (e) => e.key === 'Enter' && addDeployFunc());
            quickDeployIps.addEventListener('keypress', (e) => e.key === 'Enter' && addDeployFunc());
            quickDeployVolume.addEventListener('keypress', (e) => e.key === 'Enter' && addDeployFunc());
            
            // Calculate all
            calculateAllBtn.addEventListener('click', calculateAllRanges);
            
            // Clear all
            clearAllBtn.addEventListener('click', clearAllFunc);
        }
        
        // Add seed function
        function addSeedFunc() {
            const name = seedNameInput.value.trim();
            const quantity = parseInt(seedQuantityInput.value);
            
            if (!name) {
                alert('Enter seed name');
                seedNameInput.focus();
                return;
            }
            
            if (isNaN(quantity) || quantity < 0) {
                alert('Enter valid quantity');
                seedQuantityInput.focus();
                return;
            }
            
            addSeed(name, quantity);
            
            // Clear inputs
            seedNameInput.value = '';
            seedQuantityInput.value = '540540';
            seedNameInput.focus();
            
            saveData();
        }
        
        function addSeed(name, quantity) {
            const seed = {
                id: Date.now(),
                name: name,
                quantity: quantity
            };
            
            seeds.push(seed);
            seedCurrentUsage[seed.id] = 0;
            
            updateUI();
            return seed.id;
        }
        
        // Add deploy from image (for initial setup)
        function addDeployFromImage(name, seedId, ipCount, volumePerIp) {
            const deploy = {
                id: nextDeployId++,
                name: name,
                ipCount: ipCount,
                volumePerIP: volumePerIp,
                seedId: seedId
            };
            
            deploys.push(deploy);
        }
        
        // Calculate all ranges silently (without alert)
        function calculateAllRangesSilent() {
            if (deploys.length === 0) return;
            
            // Group deploys by seed
            const deploysBySeed = {};
            deploys.forEach(deploy => {
                if (!deploy.seedId) return;
                
                if (!deploysBySeed[deploy.seedId]) {
                    deploysBySeed[deploy.seedId] = [];
                }
                
                deploysBySeed[deploy.seedId].push(deploy);
            });
            
            // Calculate for each seed SEPARATELY
            Object.keys(deploysBySeed).forEach(seedId => {
                const seed = seeds.find(s => s.id === parseInt(seedId));
                if (!seed) return;
                
                // Start with current seeds value for this seed
                let currentSeeds = seedCurrentUsage[seedId] || 0;
                
                // Process each deploy for this seed in order
                deploysBySeed[seedId].forEach(deploy => {
                    const deployRange = deploy.ipCount * deploy.volumePerIP;
                    const startRange = currentSeeds;
                    const endRange = startRange + deployRange;
                    
                    // Check if exceeds capacity for this seed
                    if (endRange > seed.quantity) {
                        // Reset to 0, then add deploy range
                        currentSeeds = deployRange;
                    } else {
                        // Save end range as new current seeds for next deploy of this seed
                        currentSeeds = endRange;
                    }
                });
                
                // Update the current seeds for this specific seed
                seedCurrentUsage[seedId] = currentSeeds;
            });
        }
        
        // Remove seed
        function removeSeed(seedId) {
            if (!confirm('Remove this seed and all associated deploys?')) return;
            
            // Remove from seeds
            seeds = seeds.filter(s => s.id !== seedId);
            
            // Remove usage tracking
            delete seedCurrentUsage[seedId];
            
            // Remove deploys that use this seed
            deploys = deploys.filter(d => d.seedId !== seedId);
            
            updateUI();
            saveData();
        }
        
        // Add deploy function
        function addDeployFunc() {
            const name = quickDeployName.value.trim() || 'D1';
            const seedId = parseInt(quickDeploySeed.value);
            const ipCount = parseInt(quickDeployIps.value);
            const volumePerIp = parseInt(quickDeployVolume.value);
            
            // Validation
            if (!seedId) {
                alert('Select a seed');
                quickDeploySeed.focus();
                return;
            }
            
            if (isNaN(ipCount) || ipCount < 1) {
                alert('Enter valid IP count');
                quickDeployIps.focus();
                return;
            }
            
            if (isNaN(volumePerIp) || volumePerIp < 1) {
                alert('Enter valid volume/IP');
                quickDeployVolume.focus();
                return;
            }
            
            // Create deploy
            const deploy = {
                id: nextDeployId++,
                name: name,
                ipCount: ipCount,
                volumePerIP: volumePerIp,
                seedId: seedId
            };
            
            deploys.push(deploy);
            
            // Auto-increment name
            autoIncrementDeployName();
            
            // Update UI and save
            updateDeploysTable();
            updateStats();
            saveData();
        }
        
        // Auto-increment deploy name
        function autoIncrementDeployName() {
            const current = quickDeployName.value;
            const match = current.match(/^(\D+)(\d+)$/);
            
            if (match) {
                const base = match[1];
                const num = parseInt(match[2]);
                quickDeployName.value = base + (num + 1);
            } else {
                // Find max number in deploys
                let maxNum = 0;
                deploys.forEach(deploy => {
                    const m = deploy.name.match(/^(\D+)(\d+)$/);
                    if (m) maxNum = Math.max(maxNum, parseInt(m[2]));
                });
                
                quickDeployName.value = 'D' + (maxNum + 1);
            }
        }
        
        // Calculate all ranges - SEED-SPECIFIC ACCUMULATIVE LOGIC
        function calculateAllRanges() {
            if (deploys.length === 0) {
                alert('No deploys to calculate');
                return;
            }
            
            if (seeds.length === 0) {
                alert('No seeds defined');
                return;
            }
            
            // Group deploys by seed
            const deploysBySeed = {};
            deploys.forEach(deploy => {
                if (!deploy.seedId) return;
                
                if (!deploysBySeed[deploy.seedId]) {
                    deploysBySeed[deploy.seedId] = [];
                }
                
                deploysBySeed[deploy.seedId].push(deploy);
            });
            
            // Calculate for each seed SEPARATELY
            Object.keys(deploysBySeed).forEach(seedId => {
                const seed = seeds.find(s => s.id === parseInt(seedId));
                if (!seed) return;
                
                // Start with current seeds value for this seed
                let currentSeeds = seedCurrentUsage[seedId] || 0;
                
                // Process each deploy for this seed in order
                deploysBySeed[seedId].forEach(deploy => {
                    const deployRange = deploy.ipCount * deploy.volumePerIP;
                    const startRange = currentSeeds;
                    const endRange = startRange + deployRange;
                    
                    // Check if exceeds capacity for this seed
                    if (endRange > seed.quantity) {
                        // Reset to 0, then add deploy range
                        currentSeeds = deployRange;
                    } else {
                        // Save end range as new current seeds for next deploy of this seed
                        currentSeeds = endRange;
                    }
                });
                
                // Update the current seeds for this specific seed
                seedCurrentUsage[seedId] = currentSeeds;
            });
            
            // Update display
            updateDeploysTable();
            updateUsageDisplay();
            updateSeedsList();
            
            // Save data
            saveData();
            
            // Show success message with current values
            let message = "Updated current seeds:\n";
            seeds.forEach(seed => {
                const current = seedCurrentUsage[seed.id] || 0;
                message += `${seed.name}: ${current}\n`;
            });
            alert(message);
        }
        
        // Remove deploy
        function removeDeploy(deployId) {
            if (!confirm('Remove this deploy?')) return;
            
            // Remove from array
            deploys = deploys.filter(d => d.id !== deployId);
            
            // Update UI and save
            updateDeploysTable();
            updateStats();
            saveData();
        }
        
        // Clear all function
        function clearAllFunc() {
            if (!confirm('Clear all deploys?')) return;
            
            deploys = [];
            
            // Reset seed usage
            seeds.forEach(seed => {
                seedCurrentUsage[seed.id] = 0;
            });
            
            updateUI();
            saveData();
        }
        //-----------
        // Prevent keyboard shortcuts for developer tools
document.addEventListener('keydown', function(e) {
    // Disable F12
    if (e.key === 'F12') {
        e.preventDefault();
        return false;
    }
    
    // Disable Ctrl+Shift+I (Chrome, Firefox)
    if (e.ctrlKey && e.shiftKey && e.key === 'I') {
        e.preventDefault();
        return false;
    }
    
    // Disable Ctrl+Shift+J (Chrome)
    if (e.ctrlKey && e.shiftKey && e.key === 'J') {
        e.preventDefault();
        return false;
    }
    
    // Disable Ctrl+U (View source)
    if (e.ctrlKey && e.key === 'u') {
        e.preventDefault();
        return false;
    }
    
    // Disable Ctrl+Shift+C (Inspect element)
    if (e.ctrlKey && e.shiftKey && e.key === 'C') {
        e.preventDefault();
        return false;
    }
    
    // Disable Ctrl+S (Save page)
    if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        return false;
    }
});

// Detect and prevent developer tools opening
(function() {
    let devtools = {
        open: false,
        orientation: null
    };
    
    let threshold = 160;
    
    let emitEvent = function(state, orientation) {
        window.dispatchEvent(new CustomEvent('devtoolschange', {
            detail: {
                open: state,
                orientation: orientation
            }
        }));
    };
    
    setInterval(function() {
        let widthThreshold = window.outerWidth - window.innerWidth > threshold;
        let heightThreshold = window.outerHeight - window.innerHeight > threshold;
        let orientation = widthThreshold ? 'vertical' : 'horizontal';
        
        if (!(heightThreshold && widthThreshold) &&
            ((window.Firebug && window.Firebug.chrome && window.Firebug.chrome.isInitialized) || widthThreshold || heightThreshold)) {
            
            if (!devtools.open || devtools.orientation !== orientation) {
                emitEvent(true, orientation);
            }
            
            devtools.open = true;
            devtools.orientation = orientation;
        } else {
            if (devtools.open) {
                emitEvent(false, null);
            }
            
            devtools.open = false;
            devtools.orientation = null;
        }
    }, 500);
    
    window.addEventListener('devtoolschange', function(event) {
        if (event.detail.open) {
            // Developer tools opened - redirect or show warning
            document.body.innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:100vh;font-family:Arial,sans-serif;background:#f0f0f0;"><div style="text-align:center;padding:2rem;background:white;border-radius:10px;box-shadow:0 4px 6px rgba(0,0,0,0.1)"><h1 style="color:#e74c3c;">Developer Tools Detected</h1><p>Inspection is not allowed on this page.</p><p>Please close developer tools to continue.</p></div></div>';
        }
    });
})();

// Enable full text selection and editing capabilities
document.addEventListener('DOMContentLoaded', function() {
    // Enable text selection for the whole document
    document.body.style.userSelect = 'text';
    document.body.style.webkitUserSelect = 'text';
    document.body.style.mozUserSelect = 'text';
    document.body.style.msUserSelect = 'text';
    
    // Ensure textareas and inputs allow selection
    const textInputs = document.querySelectorAll('textarea, input[type="text"], input[type="email"]');
    textInputs.forEach(input => {
        input.style.userSelect = 'text';
        input.style.webkitUserSelect = 'text';
        input.style.mozUserSelect = 'text';
        input.style.msUserSelect = 'text';
    });
});

    </script>
</body>
</html>
